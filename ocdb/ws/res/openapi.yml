openapi: 3.0.0
servers:
  - url: 'http://ocdb-test:4000/eocdb/api/v0.1.0/'
info:
  title: eocdb-server
  version: "0.1.0-dev.22"
  description: |
    RESTful API for the EUMETSAT Ocean Colour In-Situ Database.
    How we utilise HTTP methods:
    * GET: get existing items - read only.
    * PUT: add new items.
    * POST: update existing items.
    * DELETE: delete existing items.
  contact:
    email: eocdb@eumetsat.eu
  license:
    name: MIT
    url: 'https://opensource.org/licenses/MIT'
tags:
  - name: Service
    description: Access to service info.
  - name: Store
    description: Access to the store.
  - name: Datasets
    description: Access to measurement datasets.
  - name: DocFiles
    description: Access to documentation files.
  - name: Users
    description: Access to users.
paths:
  '/service/info':
    get:
      tags:
        - Service
      summary: Get service information
      description: Returns information about the service as a dictionary of key-value pairs.
      operationId: getServiceInfo
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                type: object
      security:
        - api_key: []
  '/store/info':
    get:
      tags:
        - Store
      summary: Get store information
      description: Returns information about the store as a dictionary of key-value pairs.
      operationId: getStoreInfo
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                type: object
      security:
        - api_key: []
  '/store/download':
    get:
      tags:
        - Store
      summary: Batch mode download of files
      description: Download a ZIP file of datasets and optionally documentaion files for the given query from the store.
      operationId: downloadStoreFiles
      parameters:
        # Important: keep following parameters in sync with findDatasets() operation
        # {{{
        - $ref: "#/components/parameters/exprParam"
        - $ref: "#/components/parameters/regionParam"
        - $ref: "#/components/parameters/startTimeParam"
        - $ref: "#/components/parameters/endTimeParam"
        - $ref: "#/components/parameters/wdepthParam"
        - $ref: "#/components/parameters/mtypeParam"
        - $ref: "#/components/parameters/wlmodeParam"
        - $ref: "#/components/parameters/shallowParam"
        - $ref: "#/components/parameters/pmodeParam"
        - $ref: "#/components/parameters/pgroupParam"
        - $ref: "#/components/parameters/pnameParam"
        - $ref: "#/components/parameters/docsParam"
        # }}}
        - name: docs
          in: query
          description: Whether to include documentation files. Defaults to docs=0 (do not include files).
          required: false
          schema:
            type: boolean
            default: false
      responses:
        '200':
          $ref: '#/components/responses/BinaryFileContent'
        '400':
          description: Invalid query value(s).
    post:
      tags:
        - Store
      summary: Batch mode download of files
      description: Download a ZIP file of datasets and optionally documentaion files for the given list of dataset ids.
      operationId: downloadStoreFiles
      requestBody:
        $ref: '#/components/requestBodies/DatasetIds'
      responses:
        '200':
          $ref: '#/components/responses/BinaryFileContent'
        '400':
          description: Invalid query value(s).
  '/store/download/{id}':
    get:
      tags:
        - Datasets
      summary: Download a dataset by ID
      description: Returns a single dataset's files by ID.
      operationId: downloadDatasetById
      parameters:
        - $ref: "#/components/parameters/datasetIdParam"
      responses:
        '200':
          $ref: '#/components/responses/BinaryFileContent'
        '400':
          description: Invalid dataset ID.
        '404':
          description: Dataset not found.
      security:
        - api_key: []
  '/store/upload/submission':
    post:
      tags:
      - Submission
      summary: Batch mode upload of submission files
      description: Upload datasets and documentation files and insert them into the store.
      operationId: uploadStoreFiles
      requestBody:
        $ref: '#/components/requestBodies/FileUpload'
      responses:
        '200':
          $ref: '#/components/responses/DatasetValidationResults'
        '400':
          description: Invalid request.
      security:
      - eocdb_auth:
        - 'write:datasets'
        - 'read:datasets'
    get:
      tags:
        - Submission
      summary: Return a submission entry
      description: Return an existing submission  entry
      operationId: getSubmission
      parameters:
        - $ref: '#/components/parameters/submissionIdParam'
      responses:
        '200':
          $ref: '#/components/responses/Submission'
        '400':
          description: Invalid request
        '404':
          description: Submission not found in registry
      security:
        - eocdb_auth:
            - 'read:datasets'
    delete:
      tags:
        - Submission
      summary: Delete a submission
      description: Delete an existing submission and all asociated files
      operationId: deleteSubmission
      parameters:
        - $ref: '#/components/parameters/submissionIdParam'
      responses:
        '200':
          description: Deletion successfull
        '400':
          description: Invalid request
        '404':
          description: Submission not found in registry
      security:
        - eocdb_auth:
            - 'write:datasets'
            - 'read:datasets'
  '/store/status/submission':
    put:
      tags:
        - Set Submission Status
      summary: Set the status of a submission
      description: Set the status of a submission
      operationId: setSubmissionStatus
      parameters:
        - $ref: '#/components/parameters/submissionIdParam'
      requestBody:
        $ref: '#/components/requestBodies/QcInfo'
      responses:
        '200':
          description: Successful operation.
        '400':
          description: Invalid request
        '404':
          description: Submission not found in registry
      security:
        - eocdb_auth:
            - 'write:datasets'
            - 'read:datasets'
  '/store/upload/submissionfile':
    get:
      tags:
      - Submission file
      summary: Return a submission file entry
      description: Return an existing submission file entry
      operationId: getSubmissionFile
      parameters:
      - $ref: '#/components/parameters/submissionIdParam'
      - $ref: '#/components/parameters/indexParam'
      responses:
        '200':
          $ref: '#/components/responses/SubmissionFile'
        '400':
          description: Invalid request
      security:
      - eocdb_auth:
        - 'read:datasets'
    put:
      tags:
      - Submission File
      summary: Update a submission file entry
      description: Update an existing submisison file entry
      operationId: updateSubmissionFile
      requestBody:
        $ref: '#/components/requestBodies/FileUpload'
      parameters:
      - $ref: '#/components/parameters/submissionFileIdParam'
      - $ref: '#/components/parameters/indexParam'
      responses:
        '200':
          $ref: '#/components/responses/DatasetValidationResults'
        '400':
          description: Invalid request
        '404':
          description: Submission File not found in registry
      security:
      - eocdb_auth:
        - 'write:datasets'
        - 'read:datasets'
    delete:
      tags:
        - Submission File
      summary: Delete a submission file entry
      description: Delete an existing submission file entry
      operationId: deleteSubmissionFile
      parameters:
      - $ref: '#/components/parameters/submissionFileIdParam'
      - $ref: '#/components/parameters/indexParam'
      responses:
        '200':
          description: Deletion successfull
        '400':
          description: Invalid request
        '404':
          description: Submission file not found in registry
      security:
      - eocdb_auth:
        - 'write:datasets'
        - 'read:datasets'
  '/store/download/submissionfile':
    get:
      tags:
        - Submission file data file download
      summary: Download a submission file
      description: Download a submission file
      operationId: downloadSubmissionFile
      parameters:
        - $ref: '#/components/parameters/submissionIdParam'
        - $ref: '#/components/parameters/indexParam'
      responses:
        '200':
          $ref: '#/components/responses/BinaryFileContent'
        '400':
          description: Invalid request
      security:
        - eocdb_auth:
            - 'read:submission'
  '/store/upload/user':
    get:
      tags:
        - Submission
      summary: Get Submissions for user
      description: Get list of submissions for a user
      operationId: getSubmissionFilesForUser
      parameters:
      - $ref: '#/components/parameters/userIdParam'
      responses:
        '200':
          $ref: '#/components/responses/SubmissionFiles'
        '400':
          description: Invalid request
      security:
      - eocdb_auth:
        - 'read:datasets'
  '/store/upload/submission/{submissionid}':
    get:
      tags:
      - Submission
      summary: Get Submission files for submission
      description: Get list of submissions files for a subission registry entry
      operationId: getSubmissionFilesForSubmission
      parameters:
      - $ref: '#/components/parameters/submissionIdParam'
      responses:
        '200':
          $ref: '#/components/responses/SubmissionFiles'
        '400':
          description: Invalid request
        '404':
          description: No submission files found in registry
      security:
      - eocdb_auth:
        - 'read:datasets'
  '/store/status/submissionfile/{submission_id}/{index}/{status}':
    put:
      tags:
        - Set Submission File Status
      summary: Set the status of a submission file
      description: Set the status of a submission file
      operationId: setSubmissionFileStatus
      parameters:
        - $ref: '#/components/parameters/submissionFileIdParam'
        - $ref: '#/components/parameters/indexParam'
        - $ref: '#/components/parameters/submissionStatusParam'
      responses:
        '200':
          description: Successful operation.
        '400':
          description: Invalid request
        '404':
          description: Submission File not found in registry
      security:
        - eocdb_auth:
          - 'write:datasets'
          - 'read:datasets'
  # TODO by forman: address publishing/hiding datasets
  # '/datasets/publish/{id}':
  '/datasets/validate':
    post:
      tags:
        - Datasets
      summary: Validate a dataset
      description: Validates the given dataset and returns a validation report.
      operationId: validateDataset
      requestBody:
        $ref: '#/components/requestBodies/Dataset'
      responses:
        'default':
          $ref: '#/components/responses/DatasetValidationResult'
  '/datasets':
    get:
      tags:
        - Datasets
      summary: Find datasets
      description: Querys datasets by search expression, bounding box, time range, etc.
      operationId: findDatasets
      parameters:
        # Important: keep following parameters in sync with downloadStoreFiles() operation
        # {{{
        - $ref: "#/components/parameters/exprParam"
        - $ref: "#/components/parameters/regionParam"
        - $ref: "#/components/parameters/startTimeParam"
        - $ref: "#/components/parameters/endTimeParam"
        - $ref: "#/components/parameters/wdepthParam"
        - $ref: "#/components/parameters/mtypeParam"
        - $ref: "#/components/parameters/wlmodeParam"
        - $ref: "#/components/parameters/shallowParam"
        - $ref: "#/components/parameters/pmodeParam"
        - $ref: "#/components/parameters/pgroupParam"
        - $ref: "#/components/parameters/pnameParam"
        - $ref: "#/components/parameters/geojsonParam"
        # }}}
        - name: offset
          in: query
          description: Dataset start offset. First dataset is at offset=1. Defaults to 1.
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
            nullable: true
        - name: count
          in: query
          description: Maximum number of datasets in response. Defaults to 1000.
          required: false
          schema:
            type: integer
            minimum: 0
            default: 1000
            nullable: true
      responses:
        '200':
          $ref: '#/components/responses/DatasetQueryResult'
        '400':
          description: Invalid query value(s)
      security:
        - api_key: []
  '/datasets/{id}':
    get:
      tags:
        - Datasets
      summary: Get dataset by ID
      description: Returns a single dataset by ID.
      operationId: getDatasetById
      parameters:
        - $ref: "#/components/parameters/datasetIdParam"
      responses:
        '200':
          $ref: '#/components/responses/Dataset'
        '400':
          description: Invalid dataset ID.
        '404':
          description: Dataset not found.
      security:
        - api_key: []
    delete:
      tags:
        - Datasets
      summary: Delete a dataset
      description: Deletes an existing dataset by ID.
      operationId: deleteDataset
      parameters:
        - $ref: "#/components/parameters/apiKeyParam"
        - $ref: "#/components/parameters/datasetIdParam"
      responses:
        '200':
          description: Successful operation.
        '400':
          description: Invalid dataset ID.
        '404':
          description: Dataset not found.
      security:
        - eocdb_auth:
            - 'write:datasets'
            - 'read:datasets'
  '/datasets/{affil}/{project}/{cruise}':
    get:
      tags:
        - Datasets
      summary: Get all datasets for path
      description: Returns all dataset references for given path=affil/project/cruise.
      operationId: getDatasetsInPath
      parameters:
        - $ref: "#/components/parameters/affilParam"
        - $ref: "#/components/parameters/projectParam"
        - $ref: "#/components/parameters/cruiseParam"
      responses:
        '200':
          $ref: '#/components/responses/DatasetRefs'
        '400':
          description: Invalid path.
      security:
        - eocdb_auth:
            - 'read:datasets'
  '/datasets/{affil}/{project}/{cruise}/{name}':
    get:
      tags:
        - Datasets
      summary: Get dataset file from path
      description: Gets a dataset file for given path=affil/project/cruise.
      operationId: getDatasetByName
      parameters:
        - $ref: "#/components/parameters/affilParam"
        - $ref: "#/components/parameters/projectParam"
        - $ref: "#/components/parameters/cruiseParam"
        - $ref: "#/components/parameters/datasetNameParam"
      responses:
        '200':
          $ref: '#/components/responses/TextFileContent'
        '400':
          description: Invalid path.
        '404':
          description: Dataset not found.
      security:
        - eocdb_auth:
            - 'write:datasets'
            - 'read:datasets'
  '/datasets/{id}/qcinfo':
    get:
      tags:
        - Datasets
      summary: Get dataset QC information
      description: Gets a dataset's quality control information.
      operationId: getDatasetQcInfo
      parameters:
        - $ref: "#/components/parameters/datasetIdParam"
      responses:
        '200':
          $ref: '#/components/responses/QcInfo'
        '400':
          description: Invalid path.
        '404':
          description: Dataset not found.
      security:
        - eocdb_auth:
            - 'write:datasets'
            - 'read:datasets'
    post:
      tags:
        - Datasets
      summary: Set dataset QC information
      description: Sets a dataset's quality control information.
      operationId: setDatasetQcInfo
      parameters:
        - $ref: "#/components/parameters/datasetIdParam"
      requestBody:
        $ref: "#/components/requestBodies/QcInfo"
      responses:
        '200':
          description: Successful operation.
        '400':
          description: Invalid path.
        '404':
          description: Dataset not found.
      security:
        - eocdb_auth:
            - 'write:datasets'
            - 'read:datasets'
  '/docfiles':
    put:
      tags:
        - DocFiles
      summary: Add documentation file
      description: Adds a new documentation file for given path=affil/project/cruise.
      operationId: addDocFile
      requestBody:
        $ref: '#/components/requestBodies/FileUpload'
      responses:
        '200':
          description: Successful operation.
      security:
        - eocdb_auth:
            - 'write:datasets'
            - 'read:datasets'
    post:
      tags:
        - DocFiles
      summary: Update documentation file
      description: Updates an existing documentation file for given path=affil/project/cruise.
      operationId: updateDocFile
      requestBody:
        $ref: '#/components/requestBodies/FileUpload'
      responses:
        '200':
          description: Successful operation.
      security:
        - eocdb_auth:
            - 'write:datasets'
            - 'read:datasets'
  '/docfiles/{affil}/{project}/{cruise}':
    get:
      tags:
        - DocFiles
      summary: Get documentation files for path
      description: Get documentation file references for given path=affil/project/cruise.
      operationId: getDocFilesInPath
      parameters:
        - $ref: "#/components/parameters/affilParam"
        - $ref: "#/components/parameters/projectParam"
        - $ref: "#/components/parameters/cruiseParam"
      responses:
        '200':
          $ref: '#/components/responses/DocFileRefs'
        '400':
          description: Invalid path.
        '404':
          description: Documentation file not found.
  '/docfiles/{affil}/{project}/{cruise}/{name}':
    get:
      tags:
        - DocFiles
      summary: Get documentation file for path
      description: Gets binary documentation file for given path=affil/project/cruise.
      operationId: getDocFileByName
      parameters:
        - $ref: "#/components/parameters/affilParam"
        - $ref: "#/components/parameters/projectParam"
        - $ref: "#/components/parameters/cruiseParam"
        - $ref: "#/components/parameters/docFileNameParam"
      responses:
        '200':
          $ref: '#/components/responses/BinaryFileContent'
        '400':
          description: Invalid path.
        '404':
          description: Documentation file not found.
    delete:
      tags:
        - DocFiles
      summary: Delete documentation file from path
      description: Deletes a documentation file for given path=affil/project/cruise.
      operationId: deleteDocFile
      parameters:
        - $ref: "#/components/parameters/affilParam"
        - $ref: "#/components/parameters/projectParam"
        - $ref: "#/components/parameters/cruiseParam"
        - $ref: "#/components/parameters/docFileNameParam"
      responses:
        '200':
          description: Successful operation.
        '400':
          description: Invalid path.
        '404':
          description: Documentation file not found.
      security:
        - eocdb_auth:
            - 'write:docFiles'
            - 'read:docFiles'
  '/submission':
    post:
      tags:
        - Submission
      summary: Add submission register entry
      description: Register a new submission. This can only be done by a logged in user
      operationId: registerSubmission
      requestBody:
        $ref: '#/components/requestBodies/Submission'
      responses:
        '200':
          description: Submission successfully registered
        '400':
          description: Invalid request
      security:
        - eocdb_auth:
          - 'write:datasets'
          - 'read:datasets'
  '/submission/{submissionid}':
    get:
      tags:
        - Submission
      summary: Return a submission registry entry
      description: Return an existing registry entry
      operationId: getSubmission
      parameters:
        - $ref: '#/components/parameters/submissionIdParam'
      responses:
        '200':
          $ref: '#/components/responses/Submission'
        '400':
          description: Invalid request
        '404':
          description: Submission not found in registry
      security:
        - eocdb_auth:
          - 'read:datasets'
    put:
      tags:
        - Submission
      summary: Update a submission registry entry
      description: Update an existing registry entry
      operationId: updateSubmission
      requestBody:
        $ref: '#/components/requestBodies/Submission'
      parameters:
        - $ref: '#/components/parameters/submissionIdParam'
      responses:
        '200':
          description: Update successfull
        '400':
          description: Invalid request
        '404':
          description: Submission not found in registry
      security:
        - eocdb_auth:
          - 'write:datasets'
          - 'read:datasets'
    delete:
      tags:
      - Submission
      summary: Delete a submission registry entry
      description: Delete an existing registry entry
      operationId: deleteSubmission
      parameters:
        - $ref: '#/components/parameters/submissionIdParam'
      responses:
        '200':
          description: Deletion successfull
        '400':
          description: Invalid request
        '404':
          description: Submission not found in registry
      security:
        - eocdb_auth:
          - 'write:datasets'
          - 'read:datasets'
  '/submission/user/{userid}':
    get:
      tags:
        - Submission
      summary: Get Submission for user
      description: Get list of submissions for user from submission registry
      operationId: getSubmissionsForUser
      parameters:
        - $ref: '#/components/parameters/userIdParam'
      responses:
        '200':
          $ref: '#/components/responses/Submissions'
        '400':
          description: Invalid request
        '404':
          description: No submissions foudn in registry
      security:
        - eocdb_auth:
          - 'read:datasets'
  '/links':
    get:
      tags:
        - Links
      summary: Getting links for Links Page
      description: Getting links for Links Page
      operationId: getLinks
      responses:
        '200':
            description: website content as markdown
            $ref: '#/components/responses/Links'
        '400':
          description: Invalid call
    post:
      tags:
        - Links
      summary: Saving links for Links Page
      description: Saving links for Links Page
      operationId: saveLinks
      requestBody:
        $ref: '#/components/requestBodies/Links'
      responses:
        '200':
          description: Successful operation.
        '400':
          description: Invalid call

  '/users':
    post:
      tags:
        - Users
      summary: Add user
      description: Registers a new user. This can only be done by the logged in user.
      operationId: createUser
      requestBody:
        $ref: '#/components/requestBodies/UserId'
      responses:
        '200':
          description: Successful operation.
        '400':
          description: Invalid request.
  '/users/login':
    get:
      tags:
        - Users
      summary: Login user
      description: Logs a user into the system using given credentials.
      operationId: loginUser
      parameters:
        - name: username
          in: header
          description: The user name for login
          required: true
          schema:
            type: string
        - name: password
          in: header
          description: The password for login in clear text
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful operation.
          headers:
            X-Rate-Limit:
              description: calls per hour allowed by the user
              schema:
                type: integer
                format: int32
            X-Expires-After:
              description: date in UTC when token expires
              schema:
                type: string
                format: date-time
          content:
            application/json:
              schema:
                type: string
        '400':
          description: Invalid username/password supplied
  '/users/logout':
    get:
      tags:
        - Users
      summary: Logout user
      description: Logs out current logged-in user.
      operationId: logoutUser
      responses:
        '200':
          description: Successful operation.
  '/users/{id}':
    get:
      tags:
        - Users
      summary: Get user information
      description: Gets user information by user ID.
      operationId: getUserByID
      parameters:
        - $ref: '#/components/parameters/userIdParam'
      responses:
        '200':
          $ref: '#/components/responses/User'
        '400':
          description: Invalid user ID supplied.
        '404':
          description: User not found with given ID.
    put:
      tags:
        - Users
      summary: Update user information
      description: Uopdates user information by user ID. This can only be done by the logged in user.
      operationId: updateUser
      parameters:
        - $ref: '#/components/parameters/userIdParam'
      requestBody:
        $ref: '#/components/requestBodies/User'
      responses:
        '200':
          description: Successful operation.
        '400':
          description: Invalid user ID supplied.
        '404':
          description: User not found with given ID.
    delete:
      tags:
        - Users
      summary: Remove user
      description: Removes the user with the given user ID. This can only be done by the logged in user.
      operationId: deleteUser
      parameters:
        - $ref: '#/components/parameters/userIdParam'
      responses:
        '200':
          description: Successful operation.
        '400':
          description: Invalid user ID supplied.
        '404':
          description: User not found with given ID.
  '/matchupfiles':
    get:
      tags:
        - MatchupFiles
      summary: Returns a list of matchup files
      description: Returns a list of matchup files
      operationId: getMatchupFiles
      responses:
        '200':
          $ref: '#/components/responses/Submission'
        '400':
          description: Invalid request
        '404':
          description: No matchup files found

components:
  parameters:
    apiKeyParam:
      name: api_key
      in: header
      required: false
      schema:
        type: string
    affilParam:
      name: affil
      in: path
      description: Affiliation name.
      required: true
      schema:
        type: string
    projectParam:
      name: project
      in: path
      description: Project name.
      required: true
      schema:
        type: string
    cruiseParam:
      name: cruise
      in: path
      description: Cruise name.
      required: true
      schema:
        type: string
    docFileNameParam:
      name: name
      in: path
      description: Documentaion file name.
      required: true
      schema:
        type: string
    datasetNameParam:
      name: name
      in: path
      description: Dataset name.
      required: true
      schema:
        type: string
    datasetIdParam:
      name: id
      in: path
      description: ID of dataset.
      required: true
      schema:
        type: string
    exprParam:
      name: expr
      in: query
      description: Query string expression using Lucene syntax.
      required: false
      schema:
        type: string
        default: null
        nullable: true
    regionParam:
      name: region
      in: query
      description: Bounding box in decimal degree given as lon_min,lat_min,lon_max,lat_max or WKT string.
      required: false
      schema:
        type: array
        items:
          type: number
          format: double
        default: null
        nullable: true
        minItems: 4
        maxItems: 4
    startTimeParam:
      name: start_time
      in: query
      description: Start date/time. Date/time must have ISO format.
      required: false
      schema:
        type: string
        default: null
        nullable: true
    endTimeParam:
      name: end_time
      in: query
      description: End date/time. Date/time must have ISO format.
      required: false
      schema:
        type: string
        default: null
        nullable: true
    wdepthParam:
      name: wdepth
      in: query
      description: Water depth range. First value is minimum, second is maximum.
      required: false
      explode: true
      schema:
        type: array
        items:
          type: number
          format: double
        default: null
        nullable: true
        minItems: 2
        maxItems: 2
    mtypeParam:
      name: mtype
      in: query
      description: Measurement type. Defaults to "all".
      required: false
      schema:
        type: string
        default: "all"
        nullable: true
    wlmodeParam:
      name: wlmode
      in: query
      description: How to search for wavelength measurements. Defaults to "all".
      required: false
      schema:
        type: string
        enum: ["all", "multispectral", "hyperspectral"]
        default: "all"
        nullable: true
    shallowParam:
      name: shallow
      in: query
      description: How to deal with datasets with optically shallow water measurements. Defaults to "no".
      required: false
      schema:
        type: string
        enum: ["no", "yes", "exclusively"]
        default: "no"
        nullable: true
    pmodeParam:
      name: pmode
      in: query
      description: Product find mode. Applies only, if "pgroup" or "pname" are given. Defaults to "contains".
      required: false
      schema:
        type: string
        enum: ["contains", "same_cruise", "dont_apply"]
        default: "contains"
        nullable: true
    pgroupParam:
      name: pgroup
      in: query
      description: Product group(s).
      required: false
      explode: true
      schema:
        type: array
        items:
          type: string
        default: null
        nullable: true
    pnameParam:
      name: pname
      in: query
      description: Product names(s).
      required: false
      explode: true
      schema:
        type: array
        items:
          type: string
        default: null
        nullable: true
    geojsonParam:
      name: geojson
      in: query
      description: return geolocations as geoJOSN.
      required: false
      schema:
        type: boolean
        default: false
        nullable: true
    docsParam:
      name: docs
      in: query
      description: add additional documents to result.
      required: false
      schema:
        type: boolean
        default: false
        nullable: true
    userIdParam:
      name: id
      in: path
      description: The ID of the user.
      required: true
      schema:
        type: integer
    submissionIdParam:
      name: submission_id
      in: path
      description: The ID of the submission.
      required: true
      schema:
        type: string
    submissionFileIdParam:
      name: id
      in: path
      description: The ID of the submission file.
      required: true
      schema:
        type: integer
    submissionStatusParam:
      name: status
      in: path
      description: The status of the submission.
      required: true
      schema:
        type: string
        enum: ['SUBMITTED', 'VALIDATED', 'APPROVED', 'PUBLISHED']
    indexParam:
      name: index
      in: path
      description: an index parameter
      required: true
      schema:
        type: integer
  schemas:
    DatasetQuery:
      type: object
      properties:
        expr:
          type: string
          nullable: true
          default: null
        region:
          type: array
          items:
            type: number
            format: double
          nullable: true
          default: null
          minItems: 4
          maxItems: 4
        time:
          type: array
          items:
            type: string
            format: date
          nullable: true
          default: null
          minItems: 2
          maxItems: 2
        wdepth:
          type: array
          items:
            type: number
            format: double
          nullable: true
          default: null
          minItems: 2
          maxItems: 2
        mtype:
          type: string
          nullable: true
          default: "all"
        shallow:
          type: string
          nullable: true
          default: null
        pmode:
          type: string
          nullable: true
          default: "all"
        pgroup:
          type: array
          items:
            type: string
          nullable: true
          default: null
        pname:
          type: array
          items:
            type: string
          nullable: true
          default: null
        offset:
          type: integer
          minimum: 1
          nullable: true
          default: 1
        count:
          type: integer
          minimum: 0
          nullable: true
          default: 1000
    DatasetQueryResult:
      type: object
      required:
        - totalCount
        - datasets
        - query
      properties:
        totalCount:
          type: integer
        datasets:
          type: array
          items:
            $ref: '#/components/schemas/DatasetRef'
        query:
          $ref: '#/components/schemas/DatasetQuery'
    DatasetValidationResult:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum: ["OK", "WARNING", "ERROR"]
          description: Result of validation.
        issues:
          type: array
          items:
            $ref: '#/components/schemas/Issue'
          description: Validation issues. Will be empty if status is OK.
    DatasetValidationResults:
      type: object
      additionalProperties:
        $ref: '#/components/schemas/DatasetValidationResult'
    Issue:
      type: object
      required:
        - type
        - description
      properties:
        type:
          type: string
          enum: ["WARNING", "ERROR"]
          description: Type of issue.
        description:
          type: string
          description: Type of issue.
    SubmissionFile:
      type: object
      required:
        - index
        - submissionId
        - filename
        - filetype
        - status
        - result
      properties:
        index:
          type: integer
        submissionId:
          type: string
        filename:
          type: string
        filetype:
          type: string
          enum: ['MEASUREMENT', 'DOCUMENT']
        status:
          type: string
          enum: ["OK", "WARNING", "ERROR"]
        result:
          $ref: '#/components/schemas/DatasetValidationResult'
    SubmissionFileRef:
      type: object
      required:
        - index
        - submissionId
        - filename
        - filetype
        - status
      properties:
        index:
          type: integer
        submissionid:
          type: string
        filename:
          type: string
        filetype:
          type: string
          enum: ['MEASUREMENT', 'DOCUMENT']
        status:
          type: string
          enum: ["OK", "WARNING", "ERROR"]
    Submission:
      type: object
      required:
        - submissionId
        - userId
        - date
        - status
        - qcStatus
        - files
      properties:
        submissionId:
          type: string
        userid:
          type: integer
          format: int64
        date:
          type: string
        qcStatus:
          type: string
          enum: ['OK', 'WARNING', 'ERROR']
        status:
          type: string
          enum: ['SUBMITTED', 'VALIDATED', 'APPROVED','READY_TO_PUBLISHED','PUBLISHED','CANCELED']
        files:
          type: array
          items:
            $ref: '#/components/schemas/SubmissionFileRef'
    User:
      type: object
      required:
        - name
        - password
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        email:
          type: string
        password:
          type: string
        phone:
          type: string
        permissions:
          type: integer
          format: int32
    UserId:
      type: object
      required:
         - name
         - password
      properties:
         id:
           type: integer
           format: int64
    Links:
      type: object
      required:
        content:
          type: string
    Dataset:
      type: object
      required:
        - metadata
        - records
      properties:
        id:
          type: string
        path:
          type: string
        metadata:
          type: object
        records:
          type: array
          items:
            type: array
            items:
              type: number
    DatasetRef:
      type: object
      required:
        - id
        - path
      properties:
        id:
          type: string
        path:
          type: string
    DatasetIds:
      type: object
      required:
        - id_list
      properties:
        id_list:
          type: array
          items:
            type: string
        docs:
          type: boolean
    DocFileRef:
      type: object
      required:
        - path
      properties:
        path:
          type: string
    QcInfo:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum: ['SUBMITTED', 'VALIDATED', 'APPROVED','READY_TO_PUBLISHED','PUBLISHED','CANCELED']
        result:
          type: object
        date:
          type: string
  requestBodies:
    Dataset:
      description: Dataset object.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Dataset'
    DatasetIds:
      description: Successful operation.
      content:
        application/json:
          schema:
            type: array
            items:
              $ref: '#/components/schemas/DatasetIds'
    QcInfo:
      description: Quality control information.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/QcInfo'
    Submission:
      description: Entry of the submission registry
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Submission'
    SubmissionFile:
      description: Entry of the submission file
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/SubmissionFile'
    User:
      description: User object.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/User'
    UserId:
       description: User ID object.
       required: true
       content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserId'
    Links:
      description: Links object.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Links'
    FileUpload:
      description: 'File upload.'
      required: true
      content:
        # see https://swagger.io/docs/specification/describing-request-body/file-upload/
        # see https://stackoverflow.com/questions/4526273/what-does-enctype-multipart-form-data-mean
        multipart/form-data:
          schema:
            type: object
            properties:
              username:
                type: string
                description: "Current user."
              submissionid:
                type: string
                description: "Unique ID/label of a Submission"
              path:
                type: string
                description: "Target path into store given as affil/project/cruise."
              publication_date:
                type: string
                description: "Date for exposing the data the public"
              allowedtopublish:
                type: boolean
                description: "Allowed to be exposed to the public"
              docfiles:
                required: false
                type: string
                format: binary
                description: "Doc files."
              datasetfiles:
                required: true
                type: string
                format: binary
                description: "Data files."
  responses:
    DatasetQueryResult:
      description: Successful operation.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/DatasetQueryResult'
    DatasetValidationResult:
      description: Successful operation.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/DatasetValidationResult'
    DatasetValidationResults:
      description: Successful operation.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/DatasetValidationResults'
    Dataset:
      description: Successful operation.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Dataset'
    DatasetRef:
      description: Successful operation.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/DatasetRef'
    DatasetRefs:
      description: Successful operation.
      content:
        application/json:
          schema:
            type: array
            items:
              $ref: '#/components/schemas/DatasetRef'
    QcInfo:
      description: Successful operation.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/QcInfo'
    DocFileRefs:
      description: Successful operation.
      content:
        application/json:
          schema:
            type: array
            items:
              $ref: '#/components/schemas/DocFileRef'
    Submission:
      description: Submission registry entry
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Submission'
    SubmissionFile:
      description: Submission File entry
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/SubmissionFile'
    Submissions:
      description: List of submission registry entries
      content:
        application/json:
          schema:
            type: array
            items:
              $ref: '#/components/schemas/Submission'
    SubmissionFiles:
      description: List of submission file of registry entries
      content:
        application/json:
          schema:
            type: array
            items:
              $ref: '#/components/schemas/SubmissionFile'
    MatchupFiles:
      description: List of matchup file of registry entries
      content:
        application/json:
          schema:
            type: array
            items:
              type: string
    User:
      description: Successful operation.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/User'
    Links:
      description: Successful operation.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Links'
    TextFileContent:
      description: Successful operation.
      content:
        text/plain:
          schema:
            type: string
    BinaryFileContent:
      description: Successful operation.
      content:
        application/octet-stream:
          schema:
            type: string
            format: binary
  securitySchemes:
    eocdb_auth:
      type: oauth2
      flows:
        implicit:
          authorizationUrl: 'http://eocdb.io/oauth/dialog'
          scopes:
            'write:datasets': modify datasets in your account
            'read:datasets': read your datasets
            'write:docFiles': modify documentation files in your account
            'read:docFiles': read your documentation files
            'write:submissions': modify submissions
            'read:submissions': read submissions
            'write:submissionfiles': modify submissionfiles
            'read:submissionfiles': read submissionfiles
            'write:users': modify users
            'read:users': read users
    api_key:
      type: apiKey
      name: api_key
      in: header

externalDocs:
  description: Find out more about EUMETSAT Ocean Colour In-Situ Database
  url: 'http://eocdb.io'
